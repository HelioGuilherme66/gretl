topsrc = @top_srcdir@

CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datadir = @datadir@
localedir = $(datadir)/locale

have_readline = @have_readline@
READLINE_LIBS = @READLINE_LIBS@
READLINE_CFLAGS = @READLINE_CFLAGS@

GMP_CFLAGS = @GMP_CFLAGS@

ifeq ($(CC),)
  CC = gcc
endif
ifeq ($(INSTALL_PROGRAM),)
  INSTALL_PROGRAM = $(INSTALL) -m 755
endif
ifeq ($(have_readline),yes)
  RL_OBJ = complete.o
endif

GRETLLIB = ../lib/libgretl-1.0.la

# Working directories
tooldir = $(topsrc)/tools
libsrc = $(topsrc)/lib/src
VPATH = $(topsrc)/cli

#### End of system configuration section. ####

SRCS = gretlcli.c common.c complete.c
OBJS = gretlcli.o $(RL_OBJ)

DEFS = -DLOCALEDIR=\"$(localedir)\" -DHAVE_CONFIG_H

override CFLAGS += -I.. -I$(topsrc) -I$(libsrc) $(GMP_CFLAGS) $(READLINE_CFLAGS) $(DEFS)

CLI = gretlcli
LIBTOOL = ../libtool

%.o: %.c
	$(CC) -c $(CFLAGS) $<
	$(CC) -MM -MG -I$(libsrc) $(DEFS) $< >$*.d 2>/dev/null

$(CLI): $(OBJS)
	../libtool --mode=link $(CC) -o $@ $^ $(GRETLLIB) $(READLINE_LIBS) 

-include gretlcli.d

.PHONY :

install: $(CLI) installdirs
	$(LIBTOOL) $(INSTALL_PROGRAM) $(CLI) $(bindir)/$(CLI)

install-strip: $(CLI) installdirs
	$(LIBTOOL) $(INSTALL_PROGRAM) -s $(CLI) $(bindir)/$(CLI)

installdirs: $(tooldir)/mkinstalldirs
	$(tooldir)/mkinstalldirs $(bindir)

clean:
	rm -f *.o *.d $(CLI) core 
	rm -rf ./.libs

distclean: clean
	rm -f Makefile debug
