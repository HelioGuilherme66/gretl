topsrc = @top_srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@
LN = @LN_S@
have_readline = @have_readline@
have_zlib = @have_zlib@
have_gtk = @have_gtk@
CLI_LIBS = @CLI_LIBS@
RL_OBJ = @RL_OBJ@
USE_NLS = @USE_NLS@

GMP_CFLAGS = @GMP_CFLAGS@

ifeq ($(CC),)
  CC = gcc
endif
ifeq ($(INSTALL_PROGRAM),)
  INSTALL_PROGRAM = $(INSTALL) -m 755
endif
ifeq ($(LN),)
  LN = ln -sf
endif
ifeq ($(USE_NLS),yes)
  datadir = @datadir@
  localedir = $(datadir)/locale
  DEFS = -DLOCALEDIR=\"$(localedir)\" -DHAVE_CONFIG_H
endif

GRETLLIB = ../lib/libgretl-1.0.la

# General compile options and libs:
LIBS = $(CLI_LIBS)

# Directories
tooldir = $(topsrc)/tools
libsrc = $(topsrc)/lib/src
VPATH = $(topsrc)/cli

#### End of system configuration section. ####

SRCS = gretlcli.c common.c complete.c
OBJS = gretlcli.o $(RL_OBJ)

override CFLAGS += -I.. -I$(topsrc) -I$(libsrc) $(GMP_CFLAGS) $(DEFS)

CLI = gretlcli
LIBTOOL = ../libtool

%.o: %.c
	$(CC) -c $(CFLAGS) $<
	$(CC) -MM -MG -I.. -I$(topsrc) -I$(libsrc) $(DEFS) $< >$*.d 2>/dev/null

$(CLI): $(OBJS)
	../libtool --mode=link $(CC) -o $@ $^ $(GRETLLIB) $(CLI_LIBS) 

-include gretlcli.d

.PHONY :

install: $(CLI) installdirs
	$(LIBTOOL) $(INSTALL_PROGRAM) $(CLI) $(bindir)/$(CLI)

install-strip: $(CLI) installdirs
	$(LIBTOOL) $(INSTALL_PROGRAM) -s $(CLI) $(bindir)/$(CLI)

installdirs: $(tooldir)/mkinstalldirs
	$(tooldir)/mkinstalldirs $(bindir)

clean:
	rm -f *.o *.d $(CLI) core 
	rm -rf ./.libs

distclean: clean
	rm -f Makefile debug
