topsrc = @top_srcdir@
prefix = @prefix@
datarootdir = @datarootdir@

MAKE = @MAKE@
INSTALL = @INSTALL@

ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif

GFNDIR = $(prefix)/share/gretl/functions
hipsrc = $(topsrc)/addons/HIP

vpath %.inp $(hipsrc)
vpath %.spec $(hipsrc)

INP = HIP_public.inp \
      HIP_private.inp \
      HIP.inp \
      HIP_example.inp

SPEC = HIP.spec

EXAMP = HIP_example.inp

HIP.gfn: links.stamp $(INP) $(SPEC)
	gretlcli -b $(hipsrc)/HIP.inp

doc/HIP.pdf:
	$(MAKE) -C doc

links.stamp:
	if [ ! -f $(EXAMP) ] ; then ln -sf $(hipsrc)/$(EXAMP) . ; fi
	for f in $(SPEC) ; do \
	if [ ! -f $$f ] ; then ln -sf $(hipsrc)/$$f . ; fi ; done
	if [ ! -d examples ] ; then ln -s $(hipsrc)/examples . ; fi

.PHONY : check install clean

check: HIP.gfn
	$(MAKE) -C examples check

install: HIP.gfn doc/HIP.pdf
	mkdir -p $(DESTDIR)$(GFNDIR)/HIP/examples
	$(INSTALL_DATA) HIP.gfn $(DESTDIR)$(GFNDIR)/HIP
	$(INSTALL_DATA) doc/HIP.pdf $(DESTDIR)$(GFNDIR)/HIP
	for f in examples/*.inp examples/*.gdtb ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(GFNDIR)/HIP/examples ; done

zipfile: HIP.gfn doc/HIP.pdf 
	mkdir -p HIP && mkdir -p HIP/examples && cp HIP.gfn HIP && \
	cp doc/HIP.pdf HIP && cp examples/*.inp HIP/examples && \
	cp examples/*.gdtb HIP/examples && \
	zip -r HIP.zip HIP && rm -rf HIP

clean: 
	rm -f HIP.gfn links.stamp ; find . -name "*~" | xargs rm -f
	$(MAKE) -C doc clean


