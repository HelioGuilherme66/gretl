# regls plotting functions

function void regls_fcast_plot (const series y, const series yhat,
                                const bundle b)
   string tmpname
   scalar x0 = min(yhat)
   scalar x1 = max(yhat)
   scalar xd = 0.025 * (x1 - x0)
   x0 = (x0 >= 0 && x0 - xd < 0)? 0 : x0 - xd
   x1 += xd
   set force_decpoint on
   outfile --tempfile=tmpname --quiet
      printf "set title 'actual vs predicted %s (%s)'\n", b.depvar, b.estimator
      printf "set xlabel 'predicted'\n"
      printf "set ylabel 'actual'\n"
      printf "set key left top\n"
      printf "set xrange [%g:%g]\n", x0, x1
      printf "plot '-' using 1:2 title '' w p, \\\n"
      printf " x title 'actual = predicted' w l\n"
      print yhat y --data-only
      printf "e\n"
   end outfile
   set force_decpoint off
   gnuplot --input="@tmpname" --output=display
   remove(tmpname)
end function

function void regls_mse_plot (const bundle b)
   matrix M = b.XVC[,1] ~ b.lfrac
   matrix B = b.XVC
   ymin = 0.95 * minc(b.XVC[,1] - b.XVC[,2])
   ymin = ymin < 0 ? 0 : ymin
   plot M
      option with-lp
      options band=B band-style=dash
      printf "set yrange [%g:1]", ymin
      literal set xlabel 's = λ/λ-max'
      literal set ylabel 'MSE'
      literal set title 'Mean cross-validation MSE with one-s.e. band'
   end plot --output=display
end function
