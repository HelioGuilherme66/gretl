topsrc = @top_srcdir@
prefix = @prefix@
datarootdir = @datarootdir@

MAKE = @MAKE@
INSTALL = @INSTALL@

ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif

GFNDIR = $(prefix)/share/gretl/functions
ivpsrc = $(topsrc)/addons/ivpanel

vpath %.inp $(ivpsrc)
vpath %.spec $(ivpsrc)

INP = driver.inp \
      ivpanel.inp

SPEC = ivpanel.spec

HELP = ivpanel.help

ivpanel.gfn: links.stamp $(INP) $(SPEC) $(HELP) examples/nc_crime.inp
	gretlcli -b $(ivpsrc)/driver.inp

links.stamp:
	for f in $(SPEC) ; do \
	if [ ! -f $$f ] ; then ln -sf $(ivpsrc)/$$f . ; fi ; done
	for f in $(HELP) ; do \
	if [ ! -f $$f ] ; then ln -sf $(ivpsrc)/$$f . ; fi ; done
	if [ ! -d examples ] ; then ln -s $(ivpsrc)/examples . ; fi
	touch $@

ivpanel.zip: ivpanel.gfn
	mkdir ivpanel && cp ivpanel.gfn ivpanel && zip -r ivpanel.zip ivpanel \
	&& rm -rf ivpanel

.PHONY : check install clean

check: ivpanel.gfn
	$(MAKE) -C examples check

install: ivpanel.gfn
	$(INSTALL_DATA) ivpanel.gfn $(DESTDIR)$(GFNDIR)/ivpanel

clean: 
	rm -f ivpanel.gfn ivpanel-i18n.c ivpanel.xml ivpanel.zip links.stamp
	find . -name "*~" | xargs rm -f

