topsrc = @top_srcdir@
prefix = @prefix@
datarootdir = @datarootdir@

MAKE = @MAKE@
INSTALL = @INSTALL@

ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif

GFNDIR = $(prefix)/share/gretl/functions
GRETLCLI = ../../cli/gretlcli

PKG = ivpanel
PKGSRC = $(topsrc)/addons/ivpanel

vpath %.inp $(PKGSRC)
vpath %.spec $(PKGSRC)

INP = driver.inp \
      ivpanel.inp

$(PKG).gfn: links.stamp $(INP) $(PKG).spec $(PKG).help \
	examples/nc_crime.inp $(GRETLCLI)
	$(GRETLCLI) -b $(PKGSRC)/driver.inp

links.stamp:
	if [ ! -f $(PKG).spec ] ; then ln -sf $(PKGSRC)/$(PKG).spec . ; fi
	if [ ! -f $(PKG).help ] ; then ln -sf $(PKGSRC)/$(PKG).help . ; fi
	if [ ! -d examples ] ; then ln -s $(PKGSRC)/examples . ; fi
	touch $@

$(PKG).zip: $(PKG).gfn
	echo makepkg $(PKG).zip | $(GRETLCLI) -b -

.PHONY : check install clean

check: $(PKG).gfn
	$(MAKE) -C examples check

install: $(PKG).zip
	echo install $(PKG).zip --local | $(GRETLCLI) -b -

clean: 
	rm -f $(PKG).gfn $(PKG)-i18n.c $(PKG).xml $(PKG).zip links.stamp
	find . -name "*~" | xargs rm -f

