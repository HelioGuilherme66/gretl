topsrc = @top_srcdir@
prefix = @prefix@
datarootdir = @datarootdir@

MAKE = @MAKE@
INSTALL = @INSTALL@

ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif

GFNDIR = $(prefix)/share/gretl/functions
ivpsrc = $(topsrc)/addons/ivpanel

INP = driver.inp \
      ivpanel.inp

SPEC = ivpanel.spec

HELP = ivpanel.help

ivpanel.gfn: links $(INP) $(SPEC) $(HELP) examples/nc_crime.inp
	gretlcli -b driver.inp
	
.PHONY : links check install clean

links:
	for f in $(INP) ; do \
	if [ ! -f $$f ] ; then ln -sf $(ivpsrc)/$$f . ; fi ; done
	for f in $(SPEC) ; do \
	if [ ! -f $$f ] ; then ln -sf $(ivpsrc)/$$f . ; fi ; done
	for f in $(HELP) ; do \
	if [ ! -f $$f ] ; then ln -sf $(ivpsrc)/$$f . ; fi ; done
	if [ ! -d examples ] ; then ln -s $(ivpsrc)/examples . ; fi

check: ivpanel.gfn
	$(MAKE) -C examples check

install: ivpanel.gfn
	$(INSTALL_DATA) ivpanel.gfn $(DESTDIR)$(GFNDIR)/ivpanel

zipfile: ivpanel.gfn
	mkdir ivpanel && cp ivpanel.gfn ivpanel && zip -r ivpanel.zip ivpanel \
	&& rm -rf ivpanel

clean: 
	rm -f ivpanel.gfn ; find . -name "*~" | xargs rm -f

