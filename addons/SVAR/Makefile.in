topsrc = @top_srcdir@
prefix = @prefix@
datarootdir = @datarootdir@

MAKE = @MAKE@
INSTALL = @INSTALL@

ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif

GFNDIR = $(prefix)/share/gretl/functions

PKG = SVAR
PKGSRC = $(topsrc)/addons/$(PKG)

vpath %.inp $(PKGSRC)
vpath %.spec $(PKGSRC)

INP =   SVAR.inp \
	SVAR_ABfuncs.inp \
	SVAR_Cfuncs.inp \
	SVAR_constraints.inp \
	SVAR_ident.inp \
	SVAR_IRF.inp \
	SVAR_setup.inp \
	SVAR_boot.inp \
	SVAR_plots.inp \
	SVAR_utils.inp \
	pkg.inp

$(PKG).gfn: links.stamp $(INP) $(PKG).spec
	gretlcli -b $(PKGSRC)/pkg.inp

doc/$(PKG).pdf:
	$(MAKE) -C doc

links.stamp:
	if [ ! -f $(PKG).spec ] ; then ln -sf $(PKGSRC)/$(PKG).spec . ; fi
	if [ ! -d examples ] ; then ln -s $(PKGSRC)/examples . ; fi
	touch $@

$(PKG).zip: $(PKG).gfn doc/$(PKG).pdf 
	mkdir -p $(PKG) && mkdir -p $(PKG)/examples && cp $(PKG).gfn $(PKG) && \
	cp doc/$(PKG).pdf $(PKG) && cp examples/*.inp $(PKG)/examples && \
	cp examples/*.gdt $(PKG)/examples && zip -r $(PKG).zip $(PKG) && rm -rf $(PKG)

.PHONY : check install clean

install: $(PKG).gfn doc/$(PKG).pdf
	if [ -d $(DESTDIR)$(GFNDIR)/$(PKG)/ ]; then \
        rm -rf $(DESTDIR)$(GFNDIR)/$(PKG)/; fi; \
	mkdir $(DESTDIR)$(GFNDIR)/$(PKG)/
	$(INSTALL_DATA) $(PKG).gfn $(DESTDIR)$(GFNDIR)/$(PKG)
	$(INSTALL_DATA) doc/$(PKG).pdf $(DESTDIR)$(GFNDIR)/$(PKG)
	if [ -d $(DESTDIR)$(GFNDIR)/$(PKG)/examples ]; then \
        rm -rf $(DESTDIR)$(GFNDIR)/$(PKG)/examples; fi; \
	mkdir $(DESTDIR)$(GFNDIR)/$(PKG)/examples
	for f in examples/*.inp examples/*.gdt; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(GFNDIR)/$(PKG)/examples ; done

clean: 
	rm -f $(PKG).gfn $(PKG)-i18n.c $(PKG).xml $(PKG).zip links.stamp
	find . -name "*~" | xargs rm -f
	$(MAKE) -C doc clean
