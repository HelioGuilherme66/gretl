topsrc = @top_srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@
LN = @LN_S@
CLI_LIBS = @CLI_LIBS@
RL_OBJ = @RL_OBJ@
have_gtk = @have_gtk@

ifeq ($(CC),)
  CC = gcc
endif

ifeq ($(have_gtk),2.0)
  GUIDIR = gui2
else
  GUIDIR = gui
endif

INSTALL_PROGRAM = ${INSTALL} -m 755
INSTALL_DATA = ${INSTALL} -m 644

export

tooldir = $(topsrc)/tools

SUBDIRS = lib cli $(GUIDIR) plugin po
ALLSUBDIRS = lib cli gui gui2 plugin po share tests

.PHONY :

all: $(SUBDIRS)
	for d in $^ ; do $(MAKE) -C $$d ; done

clean:
	for d in $(ALLSUBDIRS) ; do $(MAKE) -C $$d clean; done

installdirs:
	$(tooldir)/mkinstalldirs $(libdir) $(includedir) $(bindir)

install: $(SUBDIRS) installdirs install-man
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d install; done
	$(MAKE) -C share install

install-strip: $(SUBDIRS) installdirs install-man	
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d install-strip; done
	$(MAKE) -C share install-strip

install-lapack: $(SUBDIRS) installdirs
	$(MAKE) -C plugin install-lapack

install-man:
	$(tooldir)/install_man $(tooldir) $(prefix) gretl.1 
	$(tooldir)/install_man $(tooldir) $(prefix) gretl-config.1

tags:
	etags lib/src/*.[hc] cli/*.[hc] $(GUIDIR)/*.[hc] plugin/*.[hc]

depend:
	for d in $(ALLSUBDIRS) ; do $(MAKE) -C $$d depend; done

distdepend:
	- for d in $(ALLSUBDIRS) ; do $(MAKE) -C $$d distdepend 2>/dev/null; done	

dist: 
	./tools/makedist

snapshot: distdepend
	./tools/makesnap

distclean: clean
	make -C win32 clean
	rm -f config.log config.cache config.status config.h 
	rm -f gretl_sh gretl-config gretl2_sh gretl2.pc
	rm -f libtool Makefile lib/Makefile cli/Makefile gui/Makefile \
	share/Makefile plugin/Makefile 
	rm -rf win32/dlls win32/import-libs win32/gtkextra-lib win32/plugins

check:
	make -C tests check








