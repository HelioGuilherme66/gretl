# open the dataset
open nile.gdt

# set up the local linear trend model with the Nile data
Nile = ksetup({nile}, {1}, {1}, {1})
Nile.diffuse = 1
Nile.obsvar = {1}

# initialize the parameters
scalar s_eta = 40
scalar s_eps = 120

# estimate the variances via MLE
scalar err = 0
mle loglik = err ? NA : Nile.llt
    matrix Nile.statevar = s_eta^2
    matrix Nile.obsvar = s_eps^2    
    err = kfilter(&Nile)
    params s_eta s_eps
end mle

# extract the smoothed trend
ksmooth(&Nile)
series nile_trend = Nile.state
