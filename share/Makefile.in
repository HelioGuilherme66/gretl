topsrc = @top_srcdir@
datarootdir = @datarootdir@

prefix = @prefix@
have_gtk = @have_gtk@
build_docs = @build_docs@

gretldir = $(prefix)/share/gretl
tooldir = $(topsrc)/tools
sharesrc = $(topsrc)/share
pdfdir = ../doc/tex

INSTALL_DATA = cp -fp

EN_GUI_HLP = $(sharesrc)/gretlgui.hlp
EN_CMD_HLP = $(sharesrc)/gretlcmd.hlp
EN_CLI_HLP = $(sharesrc)/gretlcli.hlp

ES_GUI_HLP = $(sharesrc)/gretlgui.hlp.es
ES_CMD_HLP = $(sharesrc)/gretlcmd.hlp.es
ES_CLI_HLP = $(sharesrc)/gretlcli.hlp.es

IT_GUI_HLP = $(sharesrc)/gretlgui.hlp.it
IT_CMD_HLP = $(sharesrc)/gretlcmd.hlp.it
IT_CLI_HLP = $(sharesrc)/gretlcli.hlp.it

EN_CLI_GENHLP = $(sharesrc)/genrcli.hlp
EN_GUI_GENHLP = $(sharesrc)/genrgui.hlp

IT_CLI_GENHLP = $(sharesrc)/genrcli.hlp.it
IT_GUI_GENHLP = $(sharesrc)/genrgui.hlp.it

AUTO_HELPFILES = \
	$(EN_GUI_HLP) \
	$(EN_CMD_HLP) \
	$(EN_CLI_HLP) \
	$(ES_GUI_HLP) \
	$(ES_CMD_HLP) \
	$(ES_CLI_HLP) \
	$(IT_GUI_HLP) \
	$(IT_CMD_HLP) \
	$(IT_CLI_HLP) \
	$(EN_CLI_GENHELP) \
	$(EN_GUI_GENHELP) \
	$(IT_CLI_GENHELP) \
	$(IT_GUI_GENHELP)

ifeq ($(build_docs),yes)
  query_make_help = help
  query_install_help = install_help
endif

VPATH = $(sharesrc)

all: $(query_make_help)

help:
	make -C ../doc/commands help-all

.PHONY :

install: installdirs install_datafiles install_scripts install_functions \
	install_help install_fonts $(query_install_help)
	$(INSTALL_DATA) $(sharesrc)/gretl.stamp $(DESTDIR)$(gretldir)/gretl.stamp
	make -C bcih install

install-strip: install

install_datafiles:
	for f in $(sharesrc)/data/*.gdt ; do \
	$(INSTALL_DATA) $$f $(gretldir)/data ; done
	$(INSTALL_DATA) $(sharesrc)/data/descriptions $(DESTDIR)$(gretldir)/data 
	$(INSTALL_DATA) $(sharesrc)/data/gretldata.dtd $(DESTDIR)$(gretldir)/data 
	for f in $(sharesrc)/data/greene/* ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/data/greene ; done
	for f in $(sharesrc)/data/misc/* ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/data/misc ; done
	for f in $(topsrc)/tests/*.dat ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/data/nist ; done

install_scripts:
	for f in $(sharesrc)/scripts/* ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/scripts ; done
	for f in $(sharesrc)/scripts/misc/* ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/scripts/misc ; done

install_functions:
	$(INSTALL_DATA) $(sharesrc)/functions/gretlfunc.dtd $(DESTDIR)$(gretldir)/functions 

install_man: gretl.1
	$(tooldir)/mkinstalldirs $(DESTDIR)$(prefix)/share/man/man1
	$(INSTALL_DATA) $(topsrc)/gretl.1 $(DESTDIR)$(prefix)/share/man/man1

install_help: $(query_make_help)
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/doc
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/helpfigs
	$(INSTALL_DATA) $(EN_GUI_HLP) $(DESTDIR)$(gretldir)/gretlgui.hlp
	$(INSTALL_DATA) $(EN_CMD_HLP) $(DESTDIR)$(gretldir)/gretlcmd.hlp
	$(INSTALL_DATA) $(EN_CLI_HLP) $(DESTDIR)$(gretldir)/gretlcli.hlp
	$(INSTALL_DATA) $(ES_GUI_HLP) $(DESTDIR)$(gretldir)/gretlgui.hlp.es
	$(INSTALL_DATA) $(ES_CMD_HLP) $(DESTDIR)$(gretldir)/gretlcmd.hlp.es
	$(INSTALL_DATA) $(ES_CLI_HLP) $(DESTDIR)$(gretldir)/gretlcli.hlp.es
	$(INSTALL_DATA) $(IT_GUI_HLP) $(DESTDIR)$(gretldir)/gretlgui.hlp.it
	$(INSTALL_DATA) $(IT_CMD_HLP) $(DESTDIR)$(gretldir)/gretlcmd.hlp.it
	$(INSTALL_DATA) $(IT_CLI_HLP) $(DESTDIR)$(gretldir)/gretlcli.hlp.it
	$(INSTALL_DATA) $(EN_CLI_GENHLP) $(DESTDIR)$(gretldir)/genrcli.hlp
	$(INSTALL_DATA) $(EN_GUI_GENHLP) $(DESTDIR)$(gretldir)/genrgui.hlp
	$(INSTALL_DATA) $(IT_CLI_GENHLP) $(DESTDIR)$(gretldir)/genrcli.hlp.it
	$(INSTALL_DATA) $(IT_GUI_GENHLP) $(DESTDIR)$(gretldir)/genrgui.hlp.it
	for f in $(sharesrc)/texfigs/*.png ; do \
	$(INSTALL_DATA) $$f $(gretldir)/helpfigs ; done
	for f in $(pdfdir)/gretl-ref.pdf $(pdfdir)/gretl-guide.pdf ; do \
	if test -f $$f ; then $(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/doc ; fi ; done

install_fonts:
	for f in $(sharesrc)/fonts/*.ttf ; do \
	$(INSTALL_DATA) $$f $(DESTDIR)$(gretldir)/fonts ; done

installdirs:
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir) 
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/data 
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/data/greene
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/data/misc
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/data/nist
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/scripts
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/scripts/misc 
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/db
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/functions
	$(tooldir)/mkinstalldirs $(DESTDIR)$(gretldir)/fonts

clean:
	make -C bcih clean

textclean: 
	rm -f *.txt

helpclean:
	for f in $(AUTO_HELPFILES) ; do rm -f $$f ; done

distclean: clean
	rm -f Makefile
	make -C bcih distclean
