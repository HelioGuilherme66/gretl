topsrc = ..

prefix = @prefix@
exec_prefix = @exec_prefix@
CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@
LN = @LN_S@

XML_CFLAGS = @XML_CFLAGS@
XML_LIBS = @XML_LIBS@

ifeq ($(CC),)
  CC = gcc
endif
ifeq ($(INSTALL_PROGRAM),)
  INSTALL_PROGRAM = $(INSTALL) -m 755
endif

# Installation directory
share = $(prefix)/share/gretl

LIBTOOL = $(topsrc)/libtool
COMPILE = $(LIBTOOL) --mode=compile $(CC) -c -fPIC -DPIC $(CFLAGS) 
LINK = $(LIBTOOL) --mode=link $(CC) $(CFLAGS) -shared

GRETLINC = -I$(topsrc)/lib/src
GRETLLIB = ../lib/libgretl.la
GTKINC = `gtk-config --cflags`
GTKLIB = `gtk-config --libs`
OLEINC = `gnome-config --cflags libole2`
OLELIB = `gnome-config --libs libole2`

PLUGINS = stats_tables.so panel_data.so progress_bar.so \
	gnumeric_import.so excel_import.so


all: $(PLUGINS)

stats_tables.so: stats_tables.lo
	$(LINK) -o $@ $< $(GRETLLIB)

panel_data.so: panel_data.lo
	$(LINK) -o $@ $< $(GRETLLIB)

progress_bar.so: progress_bar.lo
	$(LINK) -o $@ $< $(GTKLIB)

gnumeric_import.so: gnumeric_import.lo
	$(LINK) -o $@ $< $(GTKLIB) $(GRETLLIB) $(XML_LIBS)

excel_import.so: excel_import.lo workbook.lo
	$(LINK) -o $@ $< $(GTKLIB) $(GRETLLIB) $(OLELIB)

%.lo : %.o

stats_tables.o: stats_tables.c $(GRETLLIB) 
	$(COMPILE) $(GRETLINC) $< 

panel_data.o: panel_data.c $(GRETLLIB)
	$(COMPILE) $(GRETLINC) $< 

progress_bar.o: progress_bar.c
	$(COMPILE) $(GRETLINC) $(GTKINC) $< 

gnumeric_import.o: gnumeric_import.c import_common.c $(GRETLLIB)
	$(COMPILE) $(GRETLINC) $(GTKINC) $(XML_CFLAGS) $< 

excel_import.o: excel_import.c import_common.c xltypes.h $(GRETLLIB)
	$(COMPILE) $(GRETLINC) $(GTKINC) $<

workbook.o: workbook.c biff.h
	$(COMPILE) $(GRETLINC) $(OLEINC) $<

$(GRETLLIB):
	$(MAKE) -C ../lib

.PHONY: 

install: $(PLUGINS) installdirs
	$(LIBTOOL) --mode=install $(INSTALL_PROGRAM) \
	$(PLUGINS) $(share)/plugins

install-strip: $(PLUGINS) installdirs
	$(LIBTOOL) --mode=install $(INSTALL_PROGRAM) -s \
	$(PLUGINS) $(share)/plugins

installdirs:
	$(topsrc)/tools/mkinstalldirs $(share)/plugins

clean:
	rm -f *.o *.lo $(PLUGINS) core 
	rm -rf .libs

depend:
	makedepend -Y$(libsrc) *.c 

# DO NOT DELETE

excel_import.o: xltypes.h
gnumeric_import.o: ../lib/src/libgretl.h ../lib/src/commands.h
gnumeric_import.o: ../lib/src/errors.h ../lib/src/estimate.h
gnumeric_import.o: ../lib/src/generate.h ../lib/src/utils.h
gnumeric_import.o: ../lib/src/compare.h ../lib/src/pvalues.h
gnumeric_import.o: ../lib/src/dataio.h ../lib/src/strutils.h
gnumeric_import.o: ../lib/src/describe.h ../lib/src/printout.h
gnumeric_import.o: ../lib/src/texprint.h ../lib/src/var.h
gnumeric_import.o: ../lib/src/interact.h ../lib/src/graphing.h
gnumeric_import.o: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
gnumeric_import.o: ../lib/src/discrete.h ../lib/src/subsample.h
gnumeric_import.o: ../lib/src/calendar.h
panel_data.o: ../lib/src/libgretl.h ../lib/src/commands.h ../lib/src/errors.h
panel_data.o: ../lib/src/estimate.h ../lib/src/generate.h ../lib/src/utils.h
panel_data.o: ../lib/src/compare.h ../lib/src/pvalues.h ../lib/src/dataio.h
panel_data.o: ../lib/src/strutils.h ../lib/src/describe.h
panel_data.o: ../lib/src/printout.h ../lib/src/texprint.h ../lib/src/var.h
panel_data.o: ../lib/src/interact.h ../lib/src/graphing.h
panel_data.o: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
panel_data.o: ../lib/src/discrete.h ../lib/src/subsample.h
panel_data.o: ../lib/src/calendar.h
progress_bar.o: ../lib/src/libgretl.h ../lib/src/commands.h
progress_bar.o: ../lib/src/errors.h ../lib/src/estimate.h
progress_bar.o: ../lib/src/generate.h ../lib/src/utils.h ../lib/src/compare.h
progress_bar.o: ../lib/src/pvalues.h ../lib/src/dataio.h
progress_bar.o: ../lib/src/strutils.h ../lib/src/describe.h
progress_bar.o: ../lib/src/printout.h ../lib/src/texprint.h ../lib/src/var.h
progress_bar.o: ../lib/src/interact.h ../lib/src/graphing.h
progress_bar.o: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
progress_bar.o: ../lib/src/discrete.h ../lib/src/subsample.h
progress_bar.o: ../lib/src/calendar.h
stats_tables.o: ../lib/src/libgretl.h ../lib/src/commands.h
stats_tables.o: ../lib/src/errors.h ../lib/src/estimate.h
stats_tables.o: ../lib/src/generate.h ../lib/src/utils.h ../lib/src/compare.h
stats_tables.o: ../lib/src/pvalues.h ../lib/src/dataio.h
stats_tables.o: ../lib/src/strutils.h ../lib/src/describe.h
stats_tables.o: ../lib/src/printout.h ../lib/src/texprint.h ../lib/src/var.h
stats_tables.o: ../lib/src/interact.h ../lib/src/graphing.h
stats_tables.o: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
stats_tables.o: ../lib/src/discrete.h ../lib/src/subsample.h
stats_tables.o: ../lib/src/calendar.h


