topsrc = ..

prefix = @prefix@
exec_prefix = @exec_prefix@
CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@
LN = @LN_S@

have_gtk = @have_gtk@
GTK_CFLAGS = @GTK_CFLAGS@
GTK_LIBS = @GTK_LIBS@
XML_CFLAGS = @XML_CFLAGS@
XML_LIBS = @XML_LIBS@
LIBOLE2_CFLAGS = @LIBOLE2_CFLAGS@
LIBOLE2_LIBS = @LIBOLE2_LIBS@
GMP_CFLAGS = @GMP_CFLAGS@
GMP_LIBS = @GMP_LIBS@
LAPACK_LIBS = @LAPACK_LIBS@
HAVE_X12A = @HAVE_X12A@
HAVE_TRAMO = @HAVE_TRAMO@

ifeq ($(CC),)
  CC = gcc
endif
ifeq ($(INSTALL_PROGRAM),)
  INSTALL_PROGRAM = $(INSTALL) -m 755
endif

# Installation directory
plugindir = $(prefix)/lib/gretl

override CFLAGS += -I.. -DHAVE_CONFIG_H -fPIC -DPIC

LIBTOOL = $(topsrc)/libtool
COMPILE = $(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS) 
LINK = $(LIBTOOL) --mode=link $(CC) $(CFLAGS) -shared #-rpath $(plugindir)

GRETLINC = -I$(topsrc)/lib/src
GRETLLIB = ../lib/libgretl-1.0.la

ifeq ($(have_gtk),2.0)
  GTK_CFLAGS += -DGTK_DISABLE_DEPRECATED
  GRETL_LIBOLE2_CFLAGS := -I. $(shell pkg-config --cflags glib-2.0)
else
  GRETL_LIBOLE2_CFLAGS := -I. $(shell glib-config --cflags)
endif  

PLUGINS = lad.so stats_tables.so panel_data.so range-mean.so \
	progress_bar.so gnumeric_import.so excel_import.so $(TXPLUGIN)

ifdef GMP_LIBS
  PLUGINS += mp_ols.so
endif

ifdef LAPACK_LIBS
  PLUGINS += sur.so
  PLUGINS += johansen.so
  LAPACK_CFLAGS = -I.
endif

ifeq ($(HAVE_TRAMO),1)
  TXPLUGIN = tramo-x12a.so
endif
ifeq ($(HAVE_X12A),1)
  TXPLUGIN = tramo-x12a.so
endif

ifeq ($(LIBOLE2_LIBS),)
  query-ms-ole.lo = ms-ole.lo
  vpath %.c libole2
  vpath %.h libole2
  LIBOLE2_CFLAGS = $(GRETL_LIBOLE2_CFLAGS)
endif

all: $(PLUGINS)

stats_tables.so: stats_tables.lo
	$(LINK) -o $@ $< $(GRETLLIB)

panel_data.so: panel_data.lo
	$(LINK) -o $@ $< $(GRETLLIB)

range-mean.so: range-mean.lo
	$(LINK) -o $@ $< $(GRETLLIB)

lad.so: lad.lo
	$(LINK) -o $@ $< $(GRETLLIB)

tramo-x12a.so: tramo-x12a.lo tramo_options.lo
	$(LINK) -o $@ $^ $(GTK_LIBS) $(GRETLLIB)

progress_bar.so: progress_bar.lo
	$(LINK) -o $@ $< $(GTK_LIBS)

gnumeric_import.so: gnumeric_import.lo
	$(LINK) -o $@ $< $(GTK_LIBS) $(GRETLLIB) $(XML_LIBS)

excel_import.so: excel_import.lo workbook.lo $(query-ms-ole.lo)
	$(LINK) -o $@ $^ $(GTK_LIBS) $(GRETLLIB) $(LIBOLE2_LIBS)

mp_ols.so: mp_ols.lo
	$(LINK) -o $@ $< $(GRETLLIB) $(GMP_LIBS)

johansen.so: johansen.lo gretl_matrix.lo
	$(LINK) -o $@ $^ $(GRETLLIB) $(LAPACK_LIBS)

sur.so: sur.lo gretl_matrix.lo
	$(LINK) -o $@ $^ $(GRETLLIB) $(LAPACK_LIBS)

stats_tables.lo: stats_tables.c
	$(COMPILE) $(GRETLINC) $< 

panel_data.lo: panel_data.c
	$(COMPILE) $(GRETLINC) $< 

range-mean.lo: range-mean.c
	$(COMPILE) $(GRETLINC) $< 

lad.lo: lad.c
	$(COMPILE) $(GRETLINC) $< 

tramo-x12a.lo: tramo-x12a.c
	$(COMPILE) $(GRETLINC) $(GTK_CFLAGS) $< 

tramo_options.lo: tramo_options.c
	$(COMPILE) $(GRETLINC) $(GTK_CFLAGS) $< 

progress_bar.lo: progress_bar.c
	$(COMPILE) $(GRETLINC) $(GTK_CFLAGS) $< 

gnumeric_import.lo: gnumeric_import.c import_common.c
	$(COMPILE) $(GRETLINC) $(GTK_CFLAGS) $(XML_CFLAGS) $< 

excel_import.lo: excel_import.c import_common.c xltypes.h
	$(COMPILE) $(GRETLINC) $(GTK_CFLAGS) $<

workbook.lo: workbook.c biff.h
	$(COMPILE) $(GRETLINC) $(LIBOLE2_CFLAGS) $<

ms-ole.lo: ms-ole.c ms-ole.h
	$(COMPILE) $(LIBOLE2_CFLAGS) $<

mp_ols.lo: mp_ols.c
	$(COMPILE) $(GRETLINC) $(GMP_CFLAGS) $<

gretl_matrix.lo: gretl_matrix.c
	$(COMPILE) $(GRETLINC) $(LAPACK_CFLAGS) $<

johansen.lo: johansen.c
	$(COMPILE) $(GRETLINC) $<

sur.lo: sur.c
	$(COMPILE) $(GRETLINC) $<

$(GRETLLIB):
	$(MAKE) -C ../lib

.PHONY: 

install: $(PLUGINS) installdirs
	$(LIBTOOL) --mode=install $(INSTALL_PROGRAM) \
	$(PLUGINS) $(plugindir)

install-strip: $(PLUGINS) installdirs
	$(LIBTOOL) --mode=install $(INSTALL_PROGRAM) -s \
	$(PLUGINS) $(plugindir)

installdirs:
	$(topsrc)/tools/mkinstalldirs $(plugindir)

clean:
	rm -f *.o *.lo *.so core 
	rm -rf .libs

depend:
	makedepend -Y$(topsrc)/lib/src -o.lo *.c 

distdepend: depend
	$(topsrc)/tools/dist_depend.pl

# DO NOT DELETE

excel_import.lo: ../lib/src/libgretl.h ../lib/src/commands.h
excel_import.lo: ../lib/src/errors.h ../lib/src/estimate.h
excel_import.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
excel_import.lo: ../lib/src/compare.h ../lib/src/pvalues.h
excel_import.lo: ../lib/src/dataio.h ../lib/src/strutils.h
excel_import.lo: ../lib/src/describe.h ../lib/src/printout.h
excel_import.lo: ../lib/src/modelprint.h ../lib/src/texprint.h
excel_import.lo: ../lib/src/var.h ../lib/src/interact.h ../lib/src/graphing.h
excel_import.lo: ../lib/src/random.h ../lib/src/monte_carlo.h
excel_import.lo: ../lib/src/nonparam.h ../lib/src/discrete.h
excel_import.lo: ../lib/src/subsample.h ../lib/src/calendar.h
excel_import.lo: ../lib/src/system.h xltypes.h importer.h import_common.c
gnumeric_import.lo: ../lib/src/libgretl.h ../lib/src/commands.h
gnumeric_import.lo: ../lib/src/errors.h ../lib/src/estimate.h
gnumeric_import.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
gnumeric_import.lo: ../lib/src/compare.h ../lib/src/pvalues.h
gnumeric_import.lo: ../lib/src/dataio.h ../lib/src/strutils.h
gnumeric_import.lo: ../lib/src/describe.h ../lib/src/printout.h
gnumeric_import.lo: ../lib/src/modelprint.h ../lib/src/texprint.h
gnumeric_import.lo: ../lib/src/var.h ../lib/src/interact.h
gnumeric_import.lo: ../lib/src/graphing.h ../lib/src/random.h
gnumeric_import.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
gnumeric_import.lo: ../lib/src/discrete.h ../lib/src/subsample.h
gnumeric_import.lo: ../lib/src/calendar.h ../lib/src/system.h importer.h
gnumeric_import.lo: import_common.c
gretl_matrix.lo: ../lib/src/libgretl.h ../lib/src/commands.h
gretl_matrix.lo: ../lib/src/errors.h ../lib/src/estimate.h
gretl_matrix.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
gretl_matrix.lo: ../lib/src/compare.h ../lib/src/pvalues.h
gretl_matrix.lo: ../lib/src/dataio.h ../lib/src/strutils.h
gretl_matrix.lo: ../lib/src/describe.h ../lib/src/printout.h
gretl_matrix.lo: ../lib/src/modelprint.h ../lib/src/texprint.h
gretl_matrix.lo: ../lib/src/var.h ../lib/src/interact.h ../lib/src/graphing.h
gretl_matrix.lo: ../lib/src/random.h ../lib/src/monte_carlo.h
gretl_matrix.lo: ../lib/src/nonparam.h ../lib/src/discrete.h
gretl_matrix.lo: ../lib/src/subsample.h ../lib/src/calendar.h
gretl_matrix.lo: ../lib/src/system.h gretl_matrix.h f2c.h clapack_double.h
johansen.lo: ../lib/src/libgretl.h ../lib/src/commands.h ../lib/src/errors.h
johansen.lo: ../lib/src/estimate.h ../lib/src/generate.h
johansen.lo: ../lib/src/gretl_utils.h ../lib/src/compare.h
johansen.lo: ../lib/src/pvalues.h ../lib/src/dataio.h ../lib/src/strutils.h
johansen.lo: ../lib/src/describe.h ../lib/src/printout.h
johansen.lo: ../lib/src/modelprint.h ../lib/src/texprint.h ../lib/src/var.h
johansen.lo: ../lib/src/interact.h ../lib/src/graphing.h ../lib/src/random.h
johansen.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
johansen.lo: ../lib/src/discrete.h ../lib/src/subsample.h
johansen.lo: ../lib/src/calendar.h ../lib/src/system.h gretl_matrix.h f2c.h
johansen.lo: clapack_double.h
lad.lo: ../lib/src/libgretl.h ../lib/src/commands.h ../lib/src/errors.h
lad.lo: ../lib/src/estimate.h ../lib/src/generate.h ../lib/src/gretl_utils.h
lad.lo: ../lib/src/compare.h ../lib/src/pvalues.h ../lib/src/dataio.h
lad.lo: ../lib/src/strutils.h ../lib/src/describe.h ../lib/src/printout.h
lad.lo: ../lib/src/modelprint.h ../lib/src/texprint.h ../lib/src/var.h
lad.lo: ../lib/src/interact.h ../lib/src/graphing.h ../lib/src/random.h
lad.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h ../lib/src/discrete.h
lad.lo: ../lib/src/subsample.h ../lib/src/calendar.h ../lib/src/system.h
mp_ols.lo: ../lib/src/libgretl.h ../lib/src/commands.h ../lib/src/errors.h
mp_ols.lo: ../lib/src/estimate.h ../lib/src/generate.h
mp_ols.lo: ../lib/src/gretl_utils.h ../lib/src/compare.h ../lib/src/pvalues.h
mp_ols.lo: ../lib/src/dataio.h ../lib/src/strutils.h ../lib/src/describe.h
mp_ols.lo: ../lib/src/printout.h ../lib/src/modelprint.h
mp_ols.lo: ../lib/src/texprint.h ../lib/src/var.h ../lib/src/interact.h
mp_ols.lo: ../lib/src/graphing.h ../lib/src/random.h ../lib/src/monte_carlo.h
mp_ols.lo: ../lib/src/nonparam.h ../lib/src/discrete.h ../lib/src/subsample.h
mp_ols.lo: ../lib/src/calendar.h ../lib/src/system.h
panel_data.lo: ../lib/src/libgretl.h ../lib/src/commands.h
panel_data.lo: ../lib/src/errors.h ../lib/src/estimate.h
panel_data.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
panel_data.lo: ../lib/src/compare.h ../lib/src/pvalues.h ../lib/src/dataio.h
panel_data.lo: ../lib/src/strutils.h ../lib/src/describe.h
panel_data.lo: ../lib/src/printout.h ../lib/src/modelprint.h
panel_data.lo: ../lib/src/texprint.h ../lib/src/var.h ../lib/src/interact.h
panel_data.lo: ../lib/src/graphing.h ../lib/src/random.h
panel_data.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
panel_data.lo: ../lib/src/discrete.h ../lib/src/subsample.h
panel_data.lo: ../lib/src/calendar.h ../lib/src/system.h
progress_bar.lo: ../lib/src/libgretl.h ../lib/src/commands.h
progress_bar.lo: ../lib/src/errors.h ../lib/src/estimate.h
progress_bar.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
progress_bar.lo: ../lib/src/compare.h ../lib/src/pvalues.h
progress_bar.lo: ../lib/src/dataio.h ../lib/src/strutils.h
progress_bar.lo: ../lib/src/describe.h ../lib/src/printout.h
progress_bar.lo: ../lib/src/modelprint.h ../lib/src/texprint.h
progress_bar.lo: ../lib/src/var.h ../lib/src/interact.h ../lib/src/graphing.h
progress_bar.lo: ../lib/src/random.h ../lib/src/monte_carlo.h
progress_bar.lo: ../lib/src/nonparam.h ../lib/src/discrete.h
progress_bar.lo: ../lib/src/subsample.h ../lib/src/calendar.h
progress_bar.lo: ../lib/src/system.h
range-mean.lo: ../lib/src/libgretl.h ../lib/src/commands.h
range-mean.lo: ../lib/src/errors.h ../lib/src/estimate.h
range-mean.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
range-mean.lo: ../lib/src/compare.h ../lib/src/pvalues.h ../lib/src/dataio.h
range-mean.lo: ../lib/src/strutils.h ../lib/src/describe.h
range-mean.lo: ../lib/src/printout.h ../lib/src/modelprint.h
range-mean.lo: ../lib/src/texprint.h ../lib/src/var.h ../lib/src/interact.h
range-mean.lo: ../lib/src/graphing.h ../lib/src/random.h
range-mean.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
range-mean.lo: ../lib/src/discrete.h ../lib/src/subsample.h
range-mean.lo: ../lib/src/calendar.h ../lib/src/system.h
stats_tables.lo: ../lib/src/libgretl.h ../lib/src/commands.h
stats_tables.lo: ../lib/src/errors.h ../lib/src/estimate.h
stats_tables.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
stats_tables.lo: ../lib/src/compare.h ../lib/src/pvalues.h
stats_tables.lo: ../lib/src/dataio.h ../lib/src/strutils.h
stats_tables.lo: ../lib/src/describe.h ../lib/src/printout.h
stats_tables.lo: ../lib/src/modelprint.h ../lib/src/texprint.h
stats_tables.lo: ../lib/src/var.h ../lib/src/interact.h ../lib/src/graphing.h
stats_tables.lo: ../lib/src/random.h ../lib/src/monte_carlo.h
stats_tables.lo: ../lib/src/nonparam.h ../lib/src/discrete.h
stats_tables.lo: ../lib/src/subsample.h ../lib/src/calendar.h
stats_tables.lo: ../lib/src/system.h
sur.lo: ../lib/src/libgretl.h ../lib/src/commands.h ../lib/src/errors.h
sur.lo: ../lib/src/estimate.h ../lib/src/generate.h ../lib/src/gretl_utils.h
sur.lo: ../lib/src/compare.h ../lib/src/pvalues.h ../lib/src/dataio.h
sur.lo: ../lib/src/strutils.h ../lib/src/describe.h ../lib/src/printout.h
sur.lo: ../lib/src/modelprint.h ../lib/src/texprint.h ../lib/src/var.h
sur.lo: ../lib/src/interact.h ../lib/src/graphing.h ../lib/src/random.h
sur.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h ../lib/src/discrete.h
sur.lo: ../lib/src/subsample.h ../lib/src/calendar.h ../lib/src/system.h
sur.lo: gretl_matrix.h f2c.h clapack_double.h
tramo_options.lo: ../lib/src/libgretl.h ../lib/src/commands.h
tramo_options.lo: ../lib/src/errors.h ../lib/src/estimate.h
tramo_options.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
tramo_options.lo: ../lib/src/compare.h ../lib/src/pvalues.h
tramo_options.lo: ../lib/src/dataio.h ../lib/src/strutils.h
tramo_options.lo: ../lib/src/describe.h ../lib/src/printout.h
tramo_options.lo: ../lib/src/modelprint.h ../lib/src/texprint.h
tramo_options.lo: ../lib/src/var.h ../lib/src/interact.h
tramo_options.lo: ../lib/src/graphing.h ../lib/src/random.h
tramo_options.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
tramo_options.lo: ../lib/src/discrete.h ../lib/src/subsample.h
tramo_options.lo: ../lib/src/calendar.h ../lib/src/system.h tramo_x12a.h
tramo-x12a.lo: ../lib/src/libgretl.h ../lib/src/commands.h
tramo-x12a.lo: ../lib/src/errors.h ../lib/src/estimate.h
tramo-x12a.lo: ../lib/src/generate.h ../lib/src/gretl_utils.h
tramo-x12a.lo: ../lib/src/compare.h ../lib/src/pvalues.h ../lib/src/dataio.h
tramo-x12a.lo: ../lib/src/strutils.h ../lib/src/describe.h
tramo-x12a.lo: ../lib/src/printout.h ../lib/src/modelprint.h
tramo-x12a.lo: ../lib/src/texprint.h ../lib/src/var.h ../lib/src/interact.h
tramo-x12a.lo: ../lib/src/graphing.h ../lib/src/random.h
tramo-x12a.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
tramo-x12a.lo: ../lib/src/discrete.h ../lib/src/subsample.h
tramo-x12a.lo: ../lib/src/calendar.h ../lib/src/system.h tramo_x12a.h
workbook.lo: ../lib/src/libgretl.h ../lib/src/commands.h ../lib/src/errors.h
workbook.lo: ../lib/src/estimate.h ../lib/src/generate.h
workbook.lo: ../lib/src/gretl_utils.h ../lib/src/compare.h
workbook.lo: ../lib/src/pvalues.h ../lib/src/dataio.h ../lib/src/strutils.h
workbook.lo: ../lib/src/describe.h ../lib/src/printout.h
workbook.lo: ../lib/src/modelprint.h ../lib/src/texprint.h ../lib/src/var.h
workbook.lo: ../lib/src/interact.h ../lib/src/graphing.h ../lib/src/random.h
workbook.lo: ../lib/src/monte_carlo.h ../lib/src/nonparam.h
workbook.lo: ../lib/src/discrete.h ../lib/src/subsample.h
workbook.lo: ../lib/src/calendar.h ../lib/src/system.h biff.h importer.h
