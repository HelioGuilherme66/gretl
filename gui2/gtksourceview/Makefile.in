topsrc = @top_srcdir@
prefix = @prefix@

CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
XML_CFLAGS = @XML_CFLAGS@
GTK_CFLAGS = @GTK_CFLAGS@
have_gnu_regex = @have_gnu_regex@

ifeq ($(have_gnu_regex),no)
  REGEX_OBJ = regex.o
else
  REGEX_DEF = -DNATIVE_GNU_REGEX
endif

DATADIR = $(prefix)/share/gretl

VPATH = $(topsrc)/gui2/gtksourceview:$(topsrc)/gui2/gnu-regex

override CFLAGS += -I$(topsrc)/gui2 $(GTK_CFLAGS) $(XML_CFLAGS) \
	-DDATADIR=\"$(DATADIR)\" $(REGEX_DEF)

SRCS = gtksourcebuffer.c \
	gtksourceiter.c \
	gtksourcelanguage.c \
	gtksourcelanguagesmanager.c \
	gtksourcemarker.c \
	gtksourceregex.c \
	gtksourcestylescheme.c \
	gtksourcetag.c \
	gtksourcetagtable.c \
	gtksourceundomanager.c \
	gtksourceview.c \
	gtksourceview-marshal.c \
	gtksourceview-typebuiltins.c \
	gtktextregion.c 

OBJS = $(SRCS:.c=.o)

%.o: %.c
	$(CC) -c $(CFLAGS) $<
	$(CC) $(CFLAGS) -MM $< > .deps/$*.d 

LIB = libgtksourceview-lite.a

all: $(LIB)

$(LIB): .deps $(OBJS) $(REGEX_OBJ)
	ar -rs $@ $(OBJS) $(REGEX_OBJ)

.deps:
	mkdir $@

-include .deps/*.d

clean:
	rm -f *.o $(LIB)
	rm -rf .deps


