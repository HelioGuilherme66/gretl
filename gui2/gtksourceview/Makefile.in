topsrc = @top_srcdir@
prefix = @prefix@

CC = @CC@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
MAKE = @MAKE@
AR = @AR@
XML_CFLAGS = @XML_CFLAGS@
GTK_CFLAGS = @GTK_CFLAGS@
RX_CFLAGS = @CFLAGS@ -I$(topsrc)/gui2/gtksourceview
have_gnu_regex = @have_gnu_regex@
quiet_build = @quiet_build@

ifeq ($(have_gnu_regex),no)
  REGEX_OBJ = regex.o
else
  REGEX_DEF = -D_GNU_SOURCE -DNATIVE_GNU_REGEX
endif

ifeq ($(quiet_build),yes)
  AMP = @
  CCECHO = @echo "  CC    $@"
  LDECHO = @echo "  LD    $@" 
  CCV = $(CC) > /dev/null
else
  CCV = $(CC)
endif

DATADIR = $(prefix)/share/gretl

VPATH = $(topsrc)/gui2/gtksourceview:$(topsrc)/gui2/gtksourceview/gnu-regex

override CFLAGS += -I$(topsrc)/gui2 $(GTK_CFLAGS) $(XML_CFLAGS) \
	-DDATADIR=\"$(DATADIR)\" $(REGEX_DEF)

SRCS = gtksourcebuffer.c \
	gtksourceiter.c \
	gtksourcelanguage.c \
	gtksourcelanguagesmanager.c \
	gtksourcemarker.c \
	gtksourceregex.c \
	gtksourcestylescheme.c \
	gtksourcetag.c \
	gtksourcetagtable.c \
	gtksourceundomanager.c \
	gtksourceview.c \
	gtksourceview-marshal.c \
	gtksourceview-typebuiltins.c \
	gtktextregion.c 

OBJS = $(SRCS:.c=.o)

%.o: %.c
	$(CCECHO)
	$(AMP)$(CC) -c $(CFLAGS) $<
	$(AMP)$(CC) $(CFLAGS) -MM $< > .deps/$*.d 

libgtksourceview-lite.a: .deps $(OBJS) $(REGEX_OBJ)
	$(AR) -rs $@ $(OBJS) $(REGEX_OBJ)

regex.o: regex.c
	$(CCECHO)
	$(AMP)$(CC) -c $(RX_CFLAGS) $<

.deps:
	mkdir $@

-include .deps/*.d

clean:
	rm -f *.o libgtksourceview-lite.a
	rm -rf .deps


