topsrc = ..

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@
LN = @LN_S@
XML_CFLAGS = @XML_CFLAGS@
XML_LIBS = @XML_LIBS@
have_gtk = @have_gtk@

ifeq ($(INSTALL_PROGRAM),)
  INSTALL_PROGRAM = $(INSTALL) -m 755
endif
ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif
ifeq ($(LN),)
  LN = ln -sf
endif

# Installation directories
libdir = $(prefix)/lib
includedir = $(prefix)/include/gretl
aclocaldir = $(prefix)/share/aclocal
pkgconfigdir = $(libdir)/pkgconfig

INSTALLDIRS = $(libdir) $(includedir) $(aclocaldir)

# Libraries:
ifeq ($(have_gtk),2.0)
  LIBGRETL = libgretl-2.la 
  INSTALLDIRS += $(pkgconfigdir)
  INSTALL_CFG = install-cfg-new

else
  LIBGRETL = libgretl.la
  INSTALL_CFG = install-cfg-old
endif
LIBS = -lm -ldl -L/usr/local/lib -lz $(XML_LIBS)

#### End of system configuration section. ####

srcdir  = ./src
vpath %.c $(srcdir)
libdir = $(prefix)/lib
includedir = $(prefix)/include/gretl

SRCS = estimate.c compare.c gretl_utils.c errors.c pvalues.c dataio.c \
	generate.c strutils.c describe.c printout.c texprint.c var.c \
	interact.c graphing.c monte_carlo.c nonparam.c discrete.c \
	subsample.c calendar.c
HDRS = libgretl.h commands.h estimate.h gretl_utils.h errors.h pvalues.h \
	compare.h dataio.h generate.h strutils.h describe.h printout.h \
	version.h texprint.h var.h interact.h graphing.h monte_carlo.h \
	nonparam.h discrete.h subsample.h calendar.h internal.h
OBJS = $(SRCS:.c=.o)
LOBJS = $(SRCS:.c=.lo)
CEPHES_OBJ = $(wildcard ../cephes/*.lo)

LIBTOOL = $(topsrc)/libtool

override CFLAGS += -I. -I./src -I.. $(XML_CFLAGS) -DHAVE_CONFIG_H

COMPILE = $(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS)

.c.o:        
	$(COMPILE) $<

$(LIBGRETL): $(OBJS) $(LOBJS) 
	$(LIBTOOL) --mode=link $(CC) -o $@ $(LOBJS) $(CEPHES_OBJ) \
	-rpath $(prefix)/lib $(LIBS) -version-info 16:0:0

.PHONY: 

install: $(LIBGRETL) install-data
	$(LIBTOOL) $(INSTALL_PROGRAM) $< $(libdir)/$<

install-strip: $(LIBGRETL) install-data
	$(LIBTOOL) $(INSTALL_PROGRAM) -s $< $(libdir)/$<

install-data: installdirs $(INSTALL_CFG)
	$(INSTALL_DATA) $(srcdir)/*.h $(includedir)

install-cfg-old: ../gretl-config
	$(INSTALL_PROGRAM) ../gretl-config $(bindir)
	$(INSTALL_DATA) ../gretl.m4 $(aclocaldir)

install-cfg-new: ../gretl.pc
	$(INSTALL_DATA) ../gretl.pc $(pkgconfigdir)

installdirs:
	$(topsrc)/tools/mkinstalldirs $(INSTALLDIRS)

clean:
	rm -f *.o *.lo $(LIBGRETL) core 
	rm -rf ./.libs

tags:
	$(MAKE) -C $(topsrc) tags

depend:
	makedepend -Y src/*.c && \
	cat Makefile | sed s+^src/++ > Makefile.tmp && \
	mv Makefile.tmp Makefile

distdepend: depend
	$(topsrc)/tools/dist_depend.pl

# DO NOT DELETE

calendar.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
calendar.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
calendar.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
calendar.o: src/texprint.h src/var.h src/interact.h src/graphing.h
calendar.o: src/monte_carlo.h src/nonparam.h src/discrete.h
calendar.o: src/subsample.h src/calendar.h
compare.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
compare.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
compare.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
compare.o: src/texprint.h src/var.h src/interact.h src/graphing.h
compare.o: src/monte_carlo.h src/nonparam.h src/discrete.h
compare.o: src/subsample.h src/calendar.h src/internal.h
dataio.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
dataio.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
dataio.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
dataio.o: src/texprint.h src/var.h src/interact.h src/graphing.h
dataio.o: src/monte_carlo.h src/nonparam.h src/discrete.h src/subsample.h
dataio.o: src/calendar.h src/internal.h
describe.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
describe.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
describe.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
describe.o: src/texprint.h src/var.h src/interact.h src/graphing.h
describe.o: src/monte_carlo.h src/nonparam.h src/discrete.h
describe.o: src/subsample.h src/calendar.h src/internal.h
discrete.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
discrete.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
discrete.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
discrete.o: src/texprint.h src/var.h src/interact.h src/graphing.h
discrete.o: src/monte_carlo.h src/nonparam.h src/discrete.h
discrete.o: src/subsample.h src/calendar.h src/internal.h
errors.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
errors.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
errors.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
errors.o: src/texprint.h src/var.h src/interact.h src/graphing.h
errors.o: src/monte_carlo.h src/nonparam.h src/discrete.h src/subsample.h
errors.o: src/calendar.h
estimate.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
estimate.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
estimate.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
estimate.o: src/texprint.h src/var.h src/interact.h src/graphing.h
estimate.o: src/monte_carlo.h src/nonparam.h src/discrete.h
estimate.o: src/subsample.h src/calendar.h src/internal.h
generate.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
generate.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
generate.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
generate.o: src/texprint.h src/var.h src/interact.h src/graphing.h
generate.o: src/monte_carlo.h src/nonparam.h src/discrete.h
generate.o: src/subsample.h src/calendar.h src/internal.h
graphing.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
graphing.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
graphing.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
graphing.o: src/texprint.h src/var.h src/interact.h src/graphing.h
graphing.o: src/monte_carlo.h src/nonparam.h src/discrete.h
graphing.o: src/subsample.h src/calendar.h src/internal.h
gretl_utils.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
gretl_utils.o: src/generate.h src/gretl_utils.h src/compare.h
gretl_utils.o: src/pvalues.h src/dataio.h src/strutils.h src/describe.h
gretl_utils.o: src/printout.h src/texprint.h src/var.h src/interact.h
gretl_utils.o: src/graphing.h src/monte_carlo.h src/nonparam.h
gretl_utils.o: src/discrete.h src/subsample.h src/calendar.h
gretl_utils.o: src/internal.h
interact.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
interact.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
interact.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
interact.o: src/texprint.h src/var.h src/interact.h src/graphing.h
interact.o: src/monte_carlo.h src/nonparam.h src/discrete.h
interact.o: src/subsample.h src/calendar.h src/internal.h src/cmdlist.h
monte_carlo.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
monte_carlo.o: src/generate.h src/gretl_utils.h src/compare.h
monte_carlo.o: src/pvalues.h src/dataio.h src/strutils.h src/describe.h
monte_carlo.o: src/printout.h src/texprint.h src/var.h src/interact.h
monte_carlo.o: src/graphing.h src/monte_carlo.h src/nonparam.h
monte_carlo.o: src/discrete.h src/subsample.h src/calendar.h
monte_carlo.o: src/internal.h
nonparam.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
nonparam.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
nonparam.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
nonparam.o: src/texprint.h src/var.h src/interact.h src/graphing.h
nonparam.o: src/monte_carlo.h src/nonparam.h src/discrete.h
nonparam.o: src/subsample.h src/calendar.h src/internal.h
printout.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
printout.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
printout.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
printout.o: src/texprint.h src/var.h src/interact.h src/graphing.h
printout.o: src/monte_carlo.h src/nonparam.h src/discrete.h
printout.o: src/subsample.h src/calendar.h src/internal.h src/version.h
pvalues.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
pvalues.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
pvalues.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
pvalues.o: src/texprint.h src/var.h src/interact.h src/graphing.h
pvalues.o: src/monte_carlo.h src/nonparam.h src/discrete.h
pvalues.o: src/subsample.h src/calendar.h ../cephes/libprob.h
strutils.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
strutils.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
strutils.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
strutils.o: src/texprint.h src/var.h src/interact.h src/graphing.h
strutils.o: src/monte_carlo.h src/nonparam.h src/discrete.h
strutils.o: src/subsample.h src/calendar.h
subsample.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
subsample.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
subsample.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
subsample.o: src/texprint.h src/var.h src/interact.h src/graphing.h
subsample.o: src/monte_carlo.h src/nonparam.h src/discrete.h
subsample.o: src/subsample.h src/calendar.h src/internal.h
texprint.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
texprint.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
texprint.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
texprint.o: src/texprint.h src/var.h src/interact.h src/graphing.h
texprint.o: src/monte_carlo.h src/nonparam.h src/discrete.h
texprint.o: src/subsample.h src/calendar.h
var.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
var.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
var.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
var.o: src/texprint.h src/var.h src/interact.h src/graphing.h
var.o: src/monte_carlo.h src/nonparam.h src/discrete.h src/subsample.h
var.o: src/calendar.h src/internal.h
win32.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
win32.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
win32.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
win32.o: src/texprint.h src/var.h src/interact.h src/graphing.h
win32.o: src/monte_carlo.h src/nonparam.h src/discrete.h src/subsample.h
win32.o: src/calendar.h
