topsrc = ..

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
CC = @CC@
CFLAGS = @CFLAGS@
MAKE = @MAKE@
INSTALL = @INSTALL@
LN = @LN_S@
XML_CFLAGS = @XML_CFLAGS@
XML_LIBS = @XML_LIBS@
GLIB_CFLAGS = @GLIB_CFLAGS@
GLIB_LIBS = @GLIB_LIBS@
have_gtk = @have_gtk@

ifeq ($(INSTALL_PROGRAM),)
  INSTALL_PROGRAM = $(INSTALL) -m 755
endif
ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif
ifeq ($(LN),)
  LN = ln -sf
endif

# Installation directories
libdir = $(prefix)/lib
includedir = $(prefix)/include/gretl
aclocaldir = $(prefix)/share/aclocal
pkgconfigdir = $(libdir)/pkgconfig

INSTALLDIRS = $(libdir) $(includedir) $(aclocaldir)

LIBGRETL = libgretl-1.0.la 

# Libraries:
ifeq ($(have_gtk),2.0)
  INSTALLDIRS += $(pkgconfigdir)
  INSTALL_CFG = install-cfg-new
else
  INSTALL_CFG = install-cfg-old
endif

LIBS = -lm -ldl -L/usr/local/lib -lz $(XML_LIBS) $(GLIB_LIBS)

#### End of system configuration section. ####

srcdir  = ./src
vpath %.c $(srcdir) ../cephes
libdir = $(prefix)/lib
includedir = $(prefix)/include/gretl

SRCS = estimate.c compare.c gretl_utils.c errors.c pvalues.c dataio.c \
	generate.c strutils.c describe.c printout.c modelprint.c texprint.c var.c \
	interact.c graphing.c monte_carlo.c nonparam.c discrete.c \
	subsample.c calendar.c
HDRS = libgretl.h commands.h estimate.h gretl_utils.h errors.h pvalues.h \
	compare.h dataio.h generate.h strutils.h describe.h printout.h \
	modelprint.h version.h texprint.h var.h interact.h graphing.h \
	monte_carlo.h nonparam.h discrete.h subsample.h calendar.h internal.h \
	../cephes/libprob.h
CEPHES_SRC = bdtr.c chdtr.c expx2.c gdtr.c incbet.c nbdtr.c pdtr.c unity.c \
	btdtr.c const.c fdtr.c igam.c incbi.c ndtr.c polevl.c \
	chbevl.c drand.c gamma.c igami.c mtherr.c ndtri.c stdtr.c

OBJS = $(SRCS:.c=.o)
LOBJS = $(SRCS:.c=.lo)
CEPHES_OBJ = $(CEPHES_SRC:.c=.o)
CEPHES_LOBJ = $(CEPHES_SRC:.c=.lo)

LIBTOOL = $(topsrc)/libtool

override CFLAGS += -I. -I./src -I.. $(XML_CFLAGS) $(GLIB_CFLAGS) -DHAVE_CONFIG_H

COMPILE = $(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS)

.c.o:        
	$(COMPILE) $<

$(LIBGRETL): $(OBJS) $(LOBJS) $(CEPHES_OBJ) $(CEPHES_OBJ)
	$(LIBTOOL) --mode=link $(CC) -o $@ $(LOBJS) $(CEPHES_LOBJ) \
	-rpath $(prefix)/lib $(LIBS) -version-info 0:1:0

.PHONY: 

install: $(LIBGRETL) install-data
	$(LIBTOOL) $(INSTALL_PROGRAM) $< $(libdir)/$<

install-strip: $(LIBGRETL) install-data
	$(LIBTOOL) $(INSTALL_PROGRAM) -s $< $(libdir)/$<

install-data: installdirs $(INSTALL_CFG)
	$(INSTALL_DATA) $(srcdir)/*.h $(includedir)
	$(INSTALL_DATA) ../cephes/libprob.h $(includedir)

install-cfg-old: ../gretl-config
	$(INSTALL_PROGRAM) ../gretl-config $(bindir)
	$(INSTALL_DATA) ../gretl.m4 $(aclocaldir)

install-cfg-new: ../gretl.pc
	$(INSTALL_DATA) ../gretl.pc $(pkgconfigdir)

installdirs:
	$(topsrc)/tools/mkinstalldirs $(INSTALLDIRS)

clean:
	rm -f *.o *.lo $(LIBGRETL) core 
	rm -rf ./.libs

tags:
	$(MAKE) -C $(topsrc) tags

depend:
	makedepend -Y src/*.c && \
	cat Makefile | sed s+^src/++ > Makefile.tmp && \
	mv Makefile.tmp Makefile

distdepend: depend
	$(topsrc)/tools/dist_depend.pl

# DO NOT DELETE

calendar.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
calendar.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
calendar.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
calendar.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
calendar.o: src/graphing.h src/monte_carlo.h src/nonparam.h
calendar.o: src/discrete.h src/subsample.h src/calendar.h
compare.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
compare.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
compare.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
compare.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
compare.o: src/graphing.h src/monte_carlo.h src/nonparam.h src/discrete.h
compare.o: src/subsample.h src/calendar.h src/internal.h
dataio.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
dataio.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
dataio.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
dataio.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
dataio.o: src/graphing.h src/monte_carlo.h src/nonparam.h src/discrete.h
dataio.o: src/subsample.h src/calendar.h src/internal.h
describe.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
describe.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
describe.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
describe.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
describe.o: src/graphing.h src/monte_carlo.h src/nonparam.h
describe.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
discrete.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
discrete.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
discrete.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
discrete.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
discrete.o: src/graphing.h src/monte_carlo.h src/nonparam.h
discrete.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
errors.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
errors.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
errors.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
errors.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
errors.o: src/graphing.h src/monte_carlo.h src/nonparam.h src/discrete.h
errors.o: src/subsample.h src/calendar.h
estimate.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
estimate.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
estimate.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
estimate.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
estimate.o: src/graphing.h src/monte_carlo.h src/nonparam.h
estimate.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
generate.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
generate.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
generate.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
generate.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
generate.o: src/graphing.h src/monte_carlo.h src/nonparam.h
generate.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
graphing.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
graphing.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
graphing.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
graphing.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
graphing.o: src/graphing.h src/monte_carlo.h src/nonparam.h
graphing.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
gretl_utils.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
gretl_utils.o: src/generate.h src/gretl_utils.h src/compare.h
gretl_utils.o: src/pvalues.h src/dataio.h src/strutils.h src/describe.h
gretl_utils.o: src/printout.h src/modelprint.h src/texprint.h src/var.h
gretl_utils.o: src/interact.h src/graphing.h src/monte_carlo.h
gretl_utils.o: src/nonparam.h src/discrete.h src/subsample.h
gretl_utils.o: src/calendar.h src/internal.h
interact.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
interact.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
interact.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
interact.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
interact.o: src/graphing.h src/monte_carlo.h src/nonparam.h
interact.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
interact.o: src/cmdlist.h
modelprint.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
modelprint.o: src/generate.h src/gretl_utils.h src/compare.h
modelprint.o: src/pvalues.h src/dataio.h src/strutils.h src/describe.h
modelprint.o: src/printout.h src/modelprint.h src/texprint.h src/var.h
modelprint.o: src/interact.h src/graphing.h src/monte_carlo.h
modelprint.o: src/nonparam.h src/discrete.h src/subsample.h
modelprint.o: src/calendar.h src/internal.h
monte_carlo.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
monte_carlo.o: src/generate.h src/gretl_utils.h src/compare.h
monte_carlo.o: src/pvalues.h src/dataio.h src/strutils.h src/describe.h
monte_carlo.o: src/printout.h src/modelprint.h src/texprint.h src/var.h
monte_carlo.o: src/interact.h src/graphing.h src/monte_carlo.h
monte_carlo.o: src/nonparam.h src/discrete.h src/subsample.h
monte_carlo.o: src/calendar.h src/internal.h
nonparam.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
nonparam.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
nonparam.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
nonparam.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
nonparam.o: src/graphing.h src/monte_carlo.h src/nonparam.h
nonparam.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
printout.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
printout.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
printout.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
printout.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
printout.o: src/graphing.h src/monte_carlo.h src/nonparam.h
printout.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
printout.o: src/version.h
pvalues.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
pvalues.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
pvalues.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
pvalues.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
pvalues.o: src/graphing.h src/monte_carlo.h src/nonparam.h src/discrete.h
pvalues.o: src/subsample.h src/calendar.h ../cephes/libprob.h
strutils.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
strutils.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
strutils.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
strutils.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
strutils.o: src/graphing.h src/monte_carlo.h src/nonparam.h
strutils.o: src/discrete.h src/subsample.h src/calendar.h
subsample.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
subsample.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
subsample.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
subsample.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
subsample.o: src/graphing.h src/monte_carlo.h src/nonparam.h
subsample.o: src/discrete.h src/subsample.h src/calendar.h src/internal.h
texprint.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
texprint.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
texprint.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
texprint.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
texprint.o: src/graphing.h src/monte_carlo.h src/nonparam.h
texprint.o: src/discrete.h src/subsample.h src/calendar.h
var.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
var.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
var.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
var.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
var.o: src/graphing.h src/monte_carlo.h src/nonparam.h src/discrete.h
var.o: src/subsample.h src/calendar.h src/internal.h
win32.o: src/libgretl.h src/commands.h src/errors.h src/estimate.h
win32.o: src/generate.h src/gretl_utils.h src/compare.h src/pvalues.h
win32.o: src/dataio.h src/strutils.h src/describe.h src/printout.h
win32.o: src/modelprint.h src/texprint.h src/var.h src/interact.h
win32.o: src/graphing.h src/monte_carlo.h src/nonparam.h src/discrete.h
win32.o: src/subsample.h src/calendar.h
