#!/bin/sh

parent=/home/cottrell/stats/esl
WWW='allin@gretl.sourceforge.net:~/www/'

version=$(cat ${parent}/gretl/lib/src/version.h | grep GRETL_VERSION[^_] | \
     awk '{ print $NF}' | sed s/[\"\;]//g)
tarfile="gretl-${version}.tar.bz2"
topdir=/home/cottrell/stats/esl/gretl

echo "making dist file for gretl $version using filename $tarfile"

# make time stamp
cd ${topdir} && date > share/gretl.stamp

# make old-style help files
cd ${topdir}/src/commands && make -f cmdref.mk olddoc 

# make the archive and remove the dist dir
cd $parent 
echo "making archive..."
for f in `find gretl/gui -type l` ; do
   rm $f
done
make -C gretl/doc/tex clean
make -C gretl/doc/commands -f cmdref.mk clean
rm -f gretl/share/*.txt

mv gretl gretl-${version}
rm -f $tarfile 
tar cvjfX $tarfile tar_exclude gretl-${version}
mv gretl-${version} gretl



