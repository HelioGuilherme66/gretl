#!/bin/sh

WWW='allin@gretl.sourceforge.net:~/www/'
topdir=/home/cottrell/stats/esl/gretl
version=$(cat lib/src/version.h | grep version_ | \
     awk '{ print $NF}' | sed s/[\"\;]//g)
tarfile="gretl-${version}.tar.gz"

echo "making dist file for gretl $version using filename $tarfile"

# make clean first
cd ${topdir} && make clean && make -C win32 clean

# get in place and make dist directory
cd ${topdir}/..
mkdir ${topdir}/../gretl-$version

# create time stamp for updater
date > gretl/share/gretl.stamp

# copy everything across
echo "copying files to gretl-$version..."
cp -ap gretl/* gretl-$version

# go in and clean in dist dir
echo "cleaning in gretl-$version..."
cd gretl-$version && make distclean

# come back up a level
cd ${topdir}/..

# retain only the relevant parts of the doc tree
rm -rf gretl-$version/doc
mkdir gretl-$version/doc
cp -ap gretl/doc/manual.xml gretl-$version/doc
cp -ap gretl/doc/chapters gretl-$version/doc
cp -ap gretl/doc/manual.pdf gretl-$version/doc
cp -ap gretl/doc/manual-a4.pdf gretl-$version/doc
cp -ap gretl/doc/manual-html gretl-$version/doc
cp -ap gretl/doc/figures gretl-$version/doc
find gretl-$version/doc -name "*CVS" | xargs rm -rf

echo "removing various unwanted files..."
rm -rf gretl-$version/lib/src/lapack
find gretl-$version -name "*CVS" | xargs rm -rf
find gretl-$version -name "*.bak" | xargs rm -f
find gretl-$version -name "*.old" | xargs rm -f
find gretl-$version -name ".xvpics" | xargs rm -rf
find gretl-$version -name "*~" | xargs rm -f
find gretl-$version -name ".#*" | xargs rm -f
find gretl-$version -name "*.tar.gz" | xargs rm -f

# make the archive and remove the dist dir
echo "making archive..."
rm -f $tarfile
tar cvfz $tarfile gretl-$version
rm -rf gretl-$version

# scp gretl/doc/manual.pdf allin@gretl.sourceforge.net:~/www/
# scp gretl/doc/manual-a4.pdf allin@gretl.sourceforge.net:~/www/
# scp gretl/ChangeLog allin@gretl.sourceforge.net:~/www/


