#!/bin/sh

parent=/home/cottrell/stats/esl
WWW='allin@gretl.sourceforge.net:~/www/'

version=$(cat ${parent}/gretl/lib/src/version.h | grep version_ | \
     awk '{ print $NF}' | sed s/[\"\;]//g)
tarfile="gretl-${version}.tar.bz2"
topdir=/home/cottrell/stats/esl/gretl

echo "making dist file for gretl $version using filename $tarfile"

# make time stamp
cd ${topdir} && date > share/gretl.stamp

# make the archive and remove the dist dir
cd $parent 
echo "making archive..."
for f in \
  gretltypes.h \
  boxplots.c boxplots.h \
  calculator.c guiprint_common.c \
  callbacks.c callbacks.h \
  console.c console.h \
  database.c database.h \
  datafiles.c datafiles.h \
  fileselect.c \
  gpt_control.c gpt_control.h \
  gui_utils.c gui_utils.h \
  helpfiles.c helpfiles.h \
  model_table.c model_table.h \
  objectsave.c objectsave.h \
  session.c session.h \
  settings.c settings.h \
  webget.c webget.h \
  library.c library.h ; do
    rm -f gretl/gui/$f
done
mv gretl gretl-${version}
rm -f $tarfile 
tar cvyfX $tarfile tar_exclude gretl-${version}
mv gretl-${version} gretl

# scp gretl/doc/manual.pdf allin@gretl.sourceforge.net:~/www/
# scp gretl/doc/manual-a4.pdf allin@gretl.sourceforge.net:~/www/
# scp gretl/ChangeLog allin@gretl.sourceforge.net:~/www/


