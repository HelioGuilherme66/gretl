topsrc = @top_srcdir@
docsrc = $(topsrc)/doc

GUIDE = gretl-guide.pdf
REF = gretl-ref.pdf
ALTGUIDE = gretl-guide-a4.pdf
ALTREF = gretl-ref-a4.pdf

TEXSRC = cli.tex \
	criteria.tex \
	graphs.tex \
	modes.tex \
	persistent.tex \
	sampling.tex \
	trouble.tex \
	looping.tex \
	starting.tex \
	discrete.tex \
	appendices.tex \
	matrices.tex \
	introduction.tex \
	datafiles.tex \
	robust_vcv.tex \
	panel.tex \
	genr.tex \
	biblio.tex \
	mle.tex \
	gmm.tex \
	probit.tex \
	nls.tex \
	timeseries.tex \
	vecm.tex \
	functions.tex \
	gretltex.tex \
	cheatsheet.tex \
	reftables.tex \
	cmdref.tex \
	funcref.tex \
	optarg.tex

WEBDIR = /home/cottrell/stats/esl/website

all: $(GUIDE) $(REF) $(ALTGUIDE) $(ALTREF)

$(GUIDE): gretl-guide.tex links textables
	pdflatex $<
	pdflatex $<
	pdflatex $<

$(REF): gretl-ref.tex links cmdtex functex topiclist
	pdflatex $<
	pdflatex $<
	pdflatex $<

$(ALTGUIDE): gretl-guide-a4.tex links
	pdflatex $<
	pdflatex $<
	pdflatex $<

$(ALTREF): gretl-ref-a4.tex links
	pdflatex $<
	pdflatex $<
	pdflatex $<

gretl-guide.tex:
	if [ ! -f $@ ] ; then ln -sf $(docsrc)/tex/$@ . ; fi

gretl-ref.tex:
	if [ ! -f $@ ] ; then ln -sf $(docsrc)/tex/$@ . ; fi

letter: $(GUIDE) $(REF)

a4: $(ALTGUIDE) $(ALTREF)

gretl-guide-a4.tex: $(docsrc)/tex/gretl-guide.tex
	cat $< | sed s/letterpaper/a4paper/ > $@

gretl-ref-a4.tex: $(docsrc)/tex/gretl-ref.tex
	cat $< | sed s/letterpaper/a4paper/ > $@

.PHONY : links cmdtex functex textables alt onepass refpass topiclist install clean

links:
	rm -f gretl.sty && ln -s ../gretl.sty ./gretl.sty
	rm -f figures && ln -s $(docsrc)/figures ./figures
	for f in $(TEXSRC) ; do \
	if [ ! -f $$f ] ; then ln -sf $(docsrc)/tex/$$f . ; fi ; done

cmdtex:
	make -C ../commands cmdtex

topiclist:
	make -C ../commands topiclist_en

textables:
	make -C ../commands textables

functex:
	make -C ../commands functex

alt: gretl-guide-a4.pdf gretl-ref-a4.pdf

onepass: gretl-guide.tex links textables
	pdflatex $<

refpass: gretl-ref.tex links cmdtex functex topiclist
	pdflatex $<

install: $(GUIDE) $(REF)
	cp $(GUIDE) $(REF) $(WEBDIR)

clean:
	rm -f *.aux *.log *.out *.toc *.tpt *.pdf
	rm -f refbody.tex funcbody.tex cmdtopics.tex
	rm -f ../commands/textables ../commands/topiclist_en 
	rm -f ../commands/cmdtex ../commands/functex

distclean: clean
	rm -rf CVS

